/*
 VideoStir Player JavaScript library.
 @author Alexey Bass (@alexey_bass)
 @copyright VideoStir Ltd., http://videostir.com
*/
VS.jQuery(document).ready(function(){VS.Player.init()});
VS.Player={Version:"2.2.0",_containerId:"videostir-player",_containerInnerId:"videostir-player-inner",_preloadContainerId:"videostir-player-preload",_playerUrl:"http://8b249279a23ebe6382fe-bdbb90f389a017a4d0321ddd645160f1.r73.cf1.rackcdn.com/swf/130417/vs.player.swf",init:function(){},parseLegacyVideo:function(c){if(-1!==c.indexOf("://videostir.com/")){var d=c.match(/\/go\/video\/([a-z0-9]{32})/);return d&&2===d.length?d[1]:c}return c},show:function(c,d,b,a,e){e=e||{};VS.Player.isExists()&&VS.Player.remove();
a=VS.Player.parseLegacyVideo(a);VS.Stats.setHash(a);if(e["fake-show-every"]&&Math.floor(Math.random()*e["fake-show-every"]+1)===parseInt(e["fake-show-every"]))VS.Stats.trigger("jsFakeShow");else{var j=new VS.Player.Cookie(a),h=j.getViewsCount();if(e["disable-player-threshold"]){if(h>=e["disable-player-threshold"])return;delete e["disable-player-threshold"]}e.videostir_views=h;var f=VS.Player.makeCss(c,d,b),g=VS.Player.makePlayerParams(a,e);VS.Stats.trigger("jsShow",VS.jQuery.extend({},{position:c,
width:d,height:b},e));VS.jQuery(document).ready(function(){VS.jQuery("body").append('<div id="'+VS.Player._containerId+'"></div>');var a=VS.jQuery("#"+VS.Player._containerId);a.css(f);var e="",c;for(c in f)e+=c+": "+f[c]+"; ";VS.jQuery.browser.msie&&(VS.swfobject.createCSS("#"+VS.Player._containerId,e),document.getElementById(VS.Player._containerId).setAttribute("style",e));a.append('<div id="'+VS.Player._containerInnerId+'"></div>');VS.swfobject.embedSWF(VS.Player.getPlayerUrl(VS.Player.isSecure()),
VS.Player._containerInnerId,d,b,"9.0.0","",g.flashvars,g.params,g.attributes);j.addViewsCount()})}},createPreloadContainer:function(){0===VS.Player._preloadContainerCounter&&VS.jQuery("body").append('<div id="'+VS.Player._preloadContainerId+'"></div>')},removePreloadContainer:function(){var c=VS.jQuery("#"+VS.Player._preloadContainerId);if(c.length){for(var d=c.find("> *"),b=0,a=d.length;b<a;b++)VS.swfobject.removeSWF(VS.jQuery(d[b]).attr("id"));c.remove()}},_preloadContainerCounter:0,addPreloadingItemContainer:function(){VS.Player._preloadContainerCounter++;
var c=VS.Player._preloadContainerId+"-item-"+VS.Player._preloadContainerCounter;VS.jQuery("#"+VS.Player._preloadContainerId).append('<div id="'+c+'"></div>');return c},on:function(c,d){return{show:function(){var b=arguments;VS.Player.createPreloadContainer();VS.swfobject.embedSWF(VS.Player.getPlayerUrl(VS.Player.isSecure()),VS.Player.addPreloadingItemContainer(),1,1,"9.0.0","",{videoHash:VS.Player.parseLegacyVideo(b[3]),https:VS.Player.isSecure()?1:0,autop:!1},{menu:"false"},{menu:"false"});VS.jQuery(c).on(d,
function(){VS.Player.removePreloadContainer();VS.Player.show.apply(VS.Player,b)})}}},preload:function(c){VS.jQuery(document).ready(function(){VS.Stats.trigger("jsPreload");VS.Player.createPreloadContainer();VS.swfobject.embedSWF(VS.Player.getPlayerUrl(VS.Player.isSecure()),VS.Player.addPreloadingItemContainer(),1,1,"9.0.0","",{videoHash:c,https:VS.Player.isSecure()?1:0,autop:!1},{menu:"false"},{menu:"false"})})},remove:function(){VS.swfobject.removeSWF(VS.Player._containerInnerId);VS.jQuery("#"+VS.Player._containerId).remove()},
isExists:function(){return VS.jQuery("#"+VS.Player._containerId).length?!0:!1},makeCss:function(c,d,b){var a={left:"auto",top:"auto",right:"auto",bottom:"auto",position:"fixed","z-index":"1000000",margin:"0",padding:"0",width:d+"px",height:b+"px"};if("string"===typeof c)switch(c){case "top-left":a.top="0px";a.left="0px";break;case "top-right":a.top="0px";a.right="0px";break;case "bottom-left":a.bottom="0px";a.left="0px";break;case "bottom-right":a.bottom="0px";a.right="0px";break;case "center":c=
VS.jQuery(window),a.left=(c.width()-d)/2+c.scrollLeft()+"px",a.top=(c.height()-b)/2+c.scrollTop()+"px",a.right="auto",a.bottom="auto"}else if("object"===typeof c){for(var e in c)switch(e){case "left":case "top":case "right":case "bottom":c[e]=String(c[e]),!isNaN(parseFloat(c[e]))&&isFinite(c[e])&&(c[e]+="px")}VS.jQuery.extend(a,c)}else a.left="0px",a.top="0px";VS.jQuery.browser.msie&&"BackCompat"==document.compatMode&&(a.top.length&&"auto"!=a.top?(a.position="absolute !important",a.top='expression(((document.documentElement.scrollTop || document.body.scrollTop) + (!this.offsetHeight && 0)) + "px")'):
a.bottom.length&&"auto"!=a.bottom&&(a.position="absolute !important",a.top='expression(((document.documentElement.scrollTop || document.body.scrollTop) + (document.documentElement.clientHeight || document.body.clientHeight) - this.offsetHeight) + "px")',a.bottom="auto"));return a},makePlayerParams:function(c,d){var b={flashvars:{},params:{},attributes:{}};b.flashvars.videoHash=encodeURIComponent(c);b.flashvars.https=VS.Player.isSecure()?1:0;b.flashvars.videostir_referer=encodeURIComponent(VS.Player.getReferrer());
b.flashvars.vspv=VS.Player.Version;b.params.wmode="transparent";b.params.quality="high";b.params.allowScriptAccess="always";b.params.menu=!1;b.attributes.wmode="transparent";b.attributes.quality="high";b.attributes.allowScriptAccess="always";b.attributes.menu=!1;for(var a in d)switch(a){case "auto-play":b.flashvars.autop=d[a];break;case "auto-play-limit":b.flashvars.maxPlayedTimes=d[a];break;case "playback-delay":b.flashvars.delayS=d[a];break;case "on-finish":switch(d[a]){case "remove":b.flashvars.afterDone=
"close";break;case "play-button":b.flashvars.afterDone="bigPlayButton";break;case "blank":b.flashvars.afterDone="empty"}break;case "rotation":b.flashvars.rotationG=d[a];break;case "zoom":b.flashvars.zoomPerc=d[a]/100;break;case "offset-x":b.flashvars.offsetOnX=d[a];break;case "offset-y":b.flashvars.offsetOnY=d[a];break;case "on-click-open-url":b.flashvars.linkTo=!0;b.flashvars.goButtonUrl=encodeURIComponent(0===d[a].indexOf("http")?d[a]:"http://"+d[a]);break;case "on-click-open-url-target":switch(d[a]){case "blank":b.flashvars.goButtonLogic=
"newWindow";break;case "self":b.flashvars.goButtonLogic="sameWindow"}break;case "on-click-open-url-button-position":b.flashvars.goButtonFrame=1;switch(d[a]){case "left":case "center":case "right":b.flashvars.goButtonLocation=d[a]}break;case "on-click-event":b.flashvars.linkTo=!0;break;case "clip-fps":b.flashvars.clipFps=d[a];break;case "playback-freeze-frame":b.flashvars.freeze=d[a];break;default:b.flashvars[a]=d[a]}b.flashvars.freeze&&(b.flashvars.autop=!0,b.flashvars.maxPlayedTimes=1E4);return b},
getReferrer:function(){return window.location.href},getPlayerUrl:function(c){return c?"https"+VS.Player._playerUrl.replace(/\.r[0-9]{2}\./,".ssl.").substr(4):VS.Player._playerUrl},isSecure:function(){return"https:"==document.location.protocol?!0:!1}};VS.Player.Cookie=function(c){var d,b;this.getViewsCount=function(){return b?b:0};this.addViewsCount=function(a){a=a||1;VS.jQuery.cookie(d,b+a,{expires:365});b+=a};d="vsv"+c;b=(b=VS.jQuery.cookie(d))?parseInt(b):0};
VS.Player.Api={play:function(c){c=0<=c?c:VS.Player.Api.getCurrentFrame();try{return VS.swfobject.getObjectById(VS.Player._containerInnerId).play(c),!0}catch(d){}return!1},pause:function(){try{return VS.swfobject.getObjectById(VS.Player._containerInnerId).pause(),!0}catch(c){}return!1},getCurrentFrame:function(){try{return VS.swfobject.getObjectById(VS.Player._containerInnerId).getCurrentFrame()}catch(c){}return!1}};
(function(c,d,b){var a={_level:0,_statsUrl:VS.Player.isSecure()?"//videostir.com/stats/analytics/":"//stats.videostir.net/analytics/",_sendTimeout:200,_videoHash:"",_sessionId:0,_sequenceNumber:0,SEND_DISABLED:0,SEND_CONSOLE:1,SEND_SERVER:2,_stack:[],init:function(){a._sessionId=a.generateSessionId();a.bindListenners();c(b).ready(function(){a.trigger("jsDomReady")})},enable:function(e){a._level===a.SEND_CONSOLE&&(e===a.SEND_SERVER?e+=a.SEND_SERVER:e===a.SEND_DISABLED&&(e=a.SEND_CONSOLE));a._level=
parseInt(e);a._conversionLogicAttached||a.attachConversionLogic();a._level&a.SEND_SERVER&&a.sendPendingEventsFromStack()},setHash:function(e){a._videoHash=a.findHash(e)},_conversionLogicAttached:!1,sendPendingEventsFromStack:function(){var e,b,c;for(e in a._stack)b=a._stack[e],c=b[0],0===c&&(b[0]=1,a.sendEvent(b[1],b[2],b[3],b[4]))},attachConversionLogic:function(){a._conversionLogicAttached=!0;c(".vs-stats-conversion-onclick").on("click",function(b){a.triggerConversion(b)})},findHash:function(a){return(a=
a.match(/(as-[a-z0-9]{32}|[a-z0-9]{32})/))&&2===a.length?a[1]:!1},generateSessionId:function(){return parseInt(Math.floor(428*Math.random()+11)+""+((new Date).getTime()+"").substr(6))},bindListenners:function(){c(b).bind("jsShow jsDomReady jsUnload jsFakeShow jsPreload initFlash startLoading finishLoading loadError pause play mute unmute remove playbackPosition gotoLink gotoHome onclick conversion".split(" ").join(".vs-player ")+".vs-player",function(b,c){a.log(b.type,c)});c(d).bind("beforeunload",
function(){a.log("jsUnload")})},trigger:function(a,d){(d=d||!1)?c(b).trigger(a+".vs-player",[d]):c(b).trigger(a+".vs-player")},_conversionElement:null,triggerConversion:function(b){var d=c(b.currentTarget);a._conversionElement=d;d.is("a")&&b.preventDefault();b=b.currentTarget.nodeName;d.attr("vs-conversion-id")&&(b+=" conversion-id="+d.attr("vs-conversion-id"));a.trigger("conversion",b)},log:function(b,c){var d=a._sequenceNumber++,f=(new Date).getTime()-VS._zeroTime,g=0;if(!a.isJunkEvent(b,f,c)){if(a._level&
a.SEND_CONSOLE){var i=a._stack.length?f-a._stack[a._stack.length-1][2]:0,i="("+(i&&(1E3<i?(i/1E3).toFixed(1)+" s":i+" ms"))+")";console.log(a._videoHash,a._sessionId,d,f,i,b,c?c:"")}a._level&a.SEND_SERVER&&(a.sendEvent(d,f,b,c),g=1);a._stack.push([g,d,f,b,c])}},isJunkEvent:function(b,c,d){var f=!1;if(!a._stack.length)return f;var g=a._stack[a._stack.length-1];"playbackPosition"===b?g[4]===d&&(f=!0):g[3]===b&&100>Math.abs(c-g[2])&&(f=!0);return f},sendEvent:function(b,j,h,f){c.ajax({type:"get",url:a._statsUrl,
data:{h:a._videoHash,s:a._sessionId,n:b,t:j,e:h,d:f},async:"jsUnload"===h?!1:!0,crossDomain:!0,cache:!1,dataType:"jsonp",jsonp:"vs",jsonpCallback:"_",processData:!0,timeout:a._sendTimeout,fail:function(){d.log&&console.log("sendEvent ajax fail",arguments)},complete:function(){"conversion"==h&&(a._conversionElement&&a._conversionElement.is("a"))&&(d.location=a._conversionElement.attr("href"),a._conversionElement=null)}})}};d.VS.Stats=a;a.init()})(VS.jQuery,window,document);
