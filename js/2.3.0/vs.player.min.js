/*
 VideoStir Player JavaScript library.
 @author Alexey Bass (@alexey_bass)
 @copyright VideoStir Ltd., http://videostir.com
*/
VS.jQuery(document).ready(function(){VS.Player.init()});
VS.Player={Version:"2.3.0",_containerId:"videostir-player",_containerInnerId:"videostir-player-inner",_preloadContainerId:"videostir-player-preload",_playerUrl:"http://8b249279a23ebe6382fe-bdbb90f389a017a4d0321ddd645160f1.r73.cf1.rackcdn.com/swf/130506/vs.player.swf",init:function(){},parseLegacyVideo:function(b){if(-1!==b.indexOf("://videostir.com/")){var d=b.match(/\/go\/video\/([a-z0-9]{32})/);return d&&2===d.length?d[1]:b}return b},show:function(b,d,c,a,e){e=e||{};VS.Player.isExists()&&VS.Player.remove();
a=VS.Player.parseLegacyVideo(a);VS.Stats.setHash(a);if(e["fake-show-every"]&&Math.floor(Math.random()*e["fake-show-every"]+1)===parseInt(e["fake-show-every"]))VS.Stats.trigger("jsFakeShow");else{var i=new VS.Player.Cookie(a),f=i.getViewsCount();if(e["disable-player-threshold"]){if(f>=e["disable-player-threshold"])return;delete e["disable-player-threshold"]}e.videostir_views=f;var g=VS.Player.makeCss(b,d,c),h=VS.Player.makePlayerParams(a,e);VS.Stats.trigger("jsShow",VS.jQuery.extend({},{position:b,
width:d,height:c},e));VS.jQuery(document).ready(function(){VS.jQuery("body").append('<div id="'+VS.Player._containerId+'"></div>');var a=VS.jQuery("#"+VS.Player._containerId);a.css(g);var e="",b;for(b in g)e+=b+": "+g[b]+"; ";VS.jQuery.browser.msie&&(VS.swfobject.createCSS("#"+VS.Player._containerId,e),document.getElementById(VS.Player._containerId).setAttribute("style",e));a.append('<div id="'+VS.Player._containerInnerId+'"></div>');VS.swfobject.embedSWF(VS.Player.getPlayerUrl(VS.Player.isSecure()),
VS.Player._containerInnerId,d,c,"9.0.0","",h.flashvars,h.params,h.attributes);i.addViewsCount()})}},createPreloadContainer:function(){0===VS.Player._preloadContainerCounter&&VS.jQuery("body").append('<div id="'+VS.Player._preloadContainerId+'"></div>')},removePreloadContainer:function(){var b=VS.jQuery("#"+VS.Player._preloadContainerId);if(b.length){for(var d=b.find("> *"),c=0,a=d.length;c<a;c++)VS.swfobject.removeSWF(VS.jQuery(d[c]).attr("id"));b.remove()}},_preloadContainerCounter:0,addPreloadingItemContainer:function(){VS.Player._preloadContainerCounter++;
var b=VS.Player._preloadContainerId+"-item-"+VS.Player._preloadContainerCounter;VS.jQuery("#"+VS.Player._preloadContainerId).append('<div id="'+b+'"></div>');return b},on:function(b,d){return{show:function(){var c=arguments;VS.Player.createPreloadContainer();VS.swfobject.embedSWF(VS.Player.getPlayerUrl(VS.Player.isSecure()),VS.Player.addPreloadingItemContainer(),1,1,"9.0.0","",{videoHash:VS.Player.parseLegacyVideo(c[3]),https:VS.Player.isSecure()?1:0,autop:!1},{menu:"false"},{menu:"false"});VS.jQuery(b).on(d,
function(){VS.Player.removePreloadContainer();VS.Player.show.apply(VS.Player,c)})}}},preload:function(b){VS.jQuery(document).ready(function(){VS.Stats.trigger("jsPreload");VS.Player.createPreloadContainer();VS.swfobject.embedSWF(VS.Player.getPlayerUrl(VS.Player.isSecure()),VS.Player.addPreloadingItemContainer(),1,1,"9.0.0","",{videoHash:b,https:VS.Player.isSecure()?1:0,autop:!1},{menu:"false"},{menu:"false"})})},remove:function(){VS.swfobject.removeSWF(VS.Player._containerInnerId);VS.jQuery("#"+VS.Player._containerId).remove()},
isExists:function(){return VS.jQuery("#"+VS.Player._containerId).length?!0:!1},makeCss:function(b,d,c){var a={left:"auto",top:"auto",right:"auto",bottom:"auto",position:"fixed","z-index":"1000000",margin:"0",padding:"0",width:d+"px",height:c+"px"};if("string"===typeof b)switch(b){case "top-left":a.top="0px";a.left="0px";break;case "top-right":a.top="0px";a.right="0px";break;case "bottom-left":a.bottom="0px";a.left="0px";break;case "bottom-right":a.bottom="0px";a.right="0px";break;case "center":b=
VS.jQuery(window),a.left=(b.width()-d)/2+b.scrollLeft()+"px",a.top=(b.height()-c)/2+b.scrollTop()+"px",a.right="auto",a.bottom="auto"}else if("object"===typeof b){for(var e in b)switch(e){case "left":case "top":case "right":case "bottom":b[e]=String(b[e]),!isNaN(parseFloat(b[e]))&&isFinite(b[e])&&(b[e]+="px")}VS.jQuery.extend(a,b)}else a.left="0px",a.top="0px";VS.jQuery.browser.msie&&"BackCompat"==document.compatMode&&(a.top.length&&"auto"!=a.top?(a.position="absolute !important",a.top='expression(((document.documentElement.scrollTop || document.body.scrollTop) + (!this.offsetHeight && 0)) + "px")'):
a.bottom.length&&"auto"!=a.bottom&&(a.position="absolute !important",a.top='expression(((document.documentElement.scrollTop || document.body.scrollTop) + (document.documentElement.clientHeight || document.body.clientHeight) - this.offsetHeight) + "px")',a.bottom="auto"));return a},makePlayerParams:function(b,d){var c={flashvars:{},params:{},attributes:{}};c.flashvars.videoHash=encodeURIComponent(b);c.flashvars.https=VS.Player.isSecure()?1:0;c.flashvars.videostir_referer=encodeURIComponent(VS.Player.getReferrer());
c.flashvars.vspv=VS.Player.Version;c.params.wmode="transparent";c.params.quality="high";c.params.allowScriptAccess="always";c.params.menu=!1;c.attributes.wmode="transparent";c.attributes.quality="high";c.attributes.allowScriptAccess="always";c.attributes.menu=!1;for(var a in d)switch(a){case "auto-play":c.flashvars.autop=d[a];break;case "auto-play-limit":c.flashvars.maxPlayedTimes=d[a];break;case "playback-delay":c.flashvars.delayS=d[a];break;case "on-finish":switch(d[a]){case "remove":c.flashvars.afterDone=
"close";break;case "play-button":c.flashvars.afterDone="bigPlayButton";break;case "blank":c.flashvars.afterDone="empty"}break;case "rotation":c.flashvars.rotationG=d[a];break;case "zoom":c.flashvars.zoomPerc=d[a]/100;break;case "offset-x":c.flashvars.offsetOnX=d[a];break;case "offset-y":c.flashvars.offsetOnY=d[a];break;case "on-click-open-url":c.flashvars.linkTo=!0;c.flashvars.goButtonUrl=encodeURIComponent(0===d[a].indexOf("http")?d[a]:"http://"+d[a]);break;case "on-click-open-url-target":switch(d[a]){case "blank":c.flashvars.goButtonLogic=
"newWindow";break;case "self":c.flashvars.goButtonLogic="sameWindow"}break;case "on-click-open-url-button-position":c.flashvars.goButtonFrame=1;switch(d[a]){case "left":case "center":case "right":c.flashvars.goButtonLocation=d[a]}break;case "on-click-event":c.flashvars.linkTo=!0;break;case "clip-fps":c.flashvars.clipFps=d[a];break;case "playback-freeze-frame":c.flashvars.freeze=d[a];break;default:c.flashvars[a]=d[a]}c.flashvars.freeze&&(c.flashvars.autop=!0,c.flashvars.maxPlayedTimes=1E4);return c},
getReferrer:function(){return window.location.href},getPlayerUrl:function(b){return b?"https"+VS.Player._playerUrl.replace(/\.r[0-9]{2}\./,".ssl.").substr(4):VS.Player._playerUrl},isSecure:function(){return"https:"===document.location.protocol?!0:!1}};
VS.Player.Cookie=function(b){var d,c;this.getViewsCount=function(){return c[0]};this.getLastViewed=function(){return c[1]};this.addViewsCount=function(a){a=c[0]+(a||1)+"|"+Math.round((new Date).getTime()/1E3);VS.jQuery.cookie(d,a,{expires:365});c=a};d="vsv"+b;if(c=VS.jQuery.cookie(d)){var b=c,a=[0,0];if(-1!==b.indexOf("|")){var b=b.split("|"),e;for(e in b)a[e]=parseInt(b[e])}else a[0]=parseInt(b);c=a}else c=[0,0]};
VS.Player.Api={play:function(b){b=0<=b?b:VS.Player.Api.getCurrentFrame();try{return VS.swfobject.getObjectById(VS.Player._containerInnerId).play(b),!0}catch(d){}return!1},pause:function(){try{return VS.swfobject.getObjectById(VS.Player._containerInnerId).pause(),!0}catch(b){}return!1},getCurrentFrame:function(){try{return VS.swfobject.getObjectById(VS.Player._containerInnerId).getCurrentFrame()}catch(b){}return!1}};
(function(b,d,c){var a={_level:0,_statsUrl:VS.Player.isSecure()?"//videostir.com/stats/analytics/":"//stats.videostir.net/analytics/",_sendTimeout:200,_videoHash:"",_sessionId:0,_sequenceNumber:0,SEND_DISABLED:0,SEND_CONSOLE:1,SEND_SERVER:2,_stack:[],init:function(){a._sessionId=a.generateSessionId();a.bindListenners();b(c).ready(function(){a.trigger("jsDomReady")})},enable:function(e){a._level===a.SEND_CONSOLE&&(e===a.SEND_SERVER?e=a._level+a.SEND_SERVER:e===a.SEND_DISABLED&&(e=a.SEND_CONSOLE));
a._level=parseInt(e);a._conversionLogicAttached||a.attachConversionLogic();a._level&a.SEND_SERVER&&a.sendPendingEventsFromStack()},setHash:function(e){a._videoHash=a.findHash(e)},_conversionLogicAttached:!1,sendPendingEventsFromStack:function(){var e,b,c;for(e in a._stack)b=a._stack[e],c=b[0],0===c&&(b[0]=1,a.sendEvent(b[1],b[2],b[3],b[4],b[5]))},attachConversionLogic:function(){a._conversionLogicAttached=!0;b(".vs-stats-conversion-onclick").on("click",function(b){a.triggerConversion(b)})},findHash:function(a){return(a=
a.match(/(as-[a-z0-9]{32}|[a-z0-9]{32})/))&&2===a.length?a[1]:!1},generateSessionId:function(){return parseInt(Math.floor(428*Math.random()+11)+""+((new Date).getTime()+"").substr(6))},bindListenners:function(){b(c).bind("jsShow jsDomReady jsUnload jsFakeShow jsPreload initFlash startLoading finishLoading loadError pause play mute unmute remove playbackPosition gotoLink gotoHome onclick conversion unique empty".split(" ").join(".vs-player ")+".vs-player",function(b,c){a.log(b.type,c)});b(d).bind("beforeunload",
function(){a.log("jsUnload")})},trigger:function(a,d){(d=d||!1)?b(c).trigger(a+".vs-player",[d]):b(c).trigger(a+".vs-player")},_conversionElement:null,triggerConversion:function(c){var d=b(c.currentTarget);a._conversionElement=d;d.is("a")&&c.preventDefault();c=c.currentTarget.nodeName;d.attr("vs-conversion-id")&&(c+=" conversion-id="+d.attr("vs-conversion-id"));a.trigger("conversion",c)},log:function(b,c,f){var f=f||a._level,g=a._sequenceNumber++,h=(new Date).getTime()-VS._zeroTime,k=0;if(!a.isJunkEvent(b,
h,c)){if(f&a.SEND_CONSOLE&&d.console){var j=a._stack.length?h-a._stack[a._stack.length-1][3]:0,j="("+(j&&(1E3<j?(j/1E3).toFixed(1)+" s":j+" ms"))+")";console.log(a._videoHash,a._sessionId,g,h,j,b,c?c:"")}f&a.SEND_SERVER&&(a.sendEvent(a._videoHash,g,h,b,c),k=1);a._stack.push([k,a._videoHash,g,h,b,c]);"playbackPosition"===b&&"0"===c&&1===(new VS.Player.Cookie(a._videoHash)).getViewsCount()&&a.trigger("unique")}},isJunkEvent:function(b,c,d){var g=!1;if(!a._stack.length)return g;var h=a._stack[a._stack.length-
1];"playbackPosition"===b?h[5]===d&&(g=!0):h[4]===b&&100>Math.abs(c-h[3])&&(g=!0);return g},sendEvent:function(c,i,f,g,h){b.ajax({type:"get",url:a._statsUrl,data:{h:c,s:a._sessionId,n:i,t:f,e:g,d:h},async:"jsUnload"===g?!1:!0,crossDomain:!0,cache:!1,dataType:"jsonp",jsonp:"vs",jsonpCallback:"_",processData:!0,timeout:a._sendTimeout,fail:function(){d.log&&console.log("sendEvent ajax fail",arguments)},complete:function(){"conversion"===g&&(a._conversionElement&&a._conversionElement.is("a"))&&(d.location=
a._conversionElement.attr("href"),a._conversionElement=null)}})},markConversion:function(b){var c=new VS.Player.Cookie(b),d=Math.round(VS._zeroTime/1E3);0===c.getViewsCount()?(a.setHash(b),a.enable(a.SEND_SERVER),a.trigger("conversion",-1)):1===c.getViewsCount()&&108E3>d-c.getLastViewed()&&(a.setHash(b),a.enable(a.SEND_SERVER),a.trigger("conversion",1))}};d.VS.Stats=a;a.init()})(VS.jQuery,window,document);
VS.Player.Playlist=function(b){var d=b.settings,c,b=b.clips,a=[];switch(d.logic){case "show-one-never-seen":var e,i;for(e in b)if("object"===typeof b[e].clip&&(i=b[e].clip[3],0===(new VS.Player.Cookie(i)).getViewsCount())){a.push(b[e]);break}break;default:a=b}c=a;var f=0;VS.Stats.enable(1);VS.jQuery(document).bind("playbackPosition.vs-player",function(a,b){100===parseInt(b)&&VS.jQuery(document).trigger("next.vs-player-playlist")});VS.jQuery(document).bind("next.vs-player-playlist",function(){if(f<
c.length)switch(typeof c[f].clip){case "string":switch(c[f].clip){case "pause":VS.Player.remove();setTimeout(function(){VS.jQuery(document).trigger("next.vs-player-playlist")},c[f].duration);f++;break;case "empty":VS.Stats.setHash(c[f].hash),VS.Stats.log("empty",null,VS.Stats.SEND_SERVER),f++,VS.jQuery(document).trigger("next.vs-player-playlist")}break;default:VS.Player.show.apply(VS.Player,c[f].clip),f++}else"loop-forever"===d.logic&&(f=0,VS.jQuery(document).trigger("next.vs-player-playlist"))});
c.length&&VS.jQuery(document).trigger("next.vs-player-playlist")};
